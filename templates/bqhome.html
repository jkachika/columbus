{% extends "base.html" %}
{% load staticfiles %}
{% block title %}
    <title>Home</title>
{% endblock %}
{% block headers %}
    <link href="{% static 'css/jquery.growl.css' %}" rel="stylesheet" type="text/css"/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="{% static 'js/jquery.blockUI.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jquery.growl.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/overlays.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/typeahead/bootstrap3-typeahead.js' %}" type="text/javascript"></script>
{% endblock %}
{% block content %}
    <input id="searchPlace" class="controls" type="text" placeholder="Search a location"
           xmlns="http://www.w3.org/1999/html"/>
    <div id='mapDiv' class="map"></div>
    <div id='floatingDiv' class="floater col-xs-3 hidden">
        <form role="form" action="/startflow" method="post" onsubmit="return validateForm();">
            {% csrf_token %}
            {% if error != None %}
                <div id="error-holder" style="display: none">
                    {{ error }}
                </div>
            {% endif %}
            <label style="font-weight: 500; font-size: 15px; margin: 0">Data Source</label>
            <div class="radio">
                <label style="padding-bottom: 10px">
                    <input type="radio" name="datasource"
                           onclick="chooseDatasource('bigquery');" required value="bigquery" checked>
                    Bigquery
                </label>
                <div class="form-group" id="bq-details-div" style="margin: 0px 20px 0px 20px;">
                    <select id="bq-table" name="bq-table" data-live-search="true"
                            class="selectpicker show-menu-arrow show-tick" title="Choose a table"
                            data-size="5" data-width="100%">
                    </select>
                    <div style="margin-top:10px; width: 100%" class="radio">
                        <label style="width: 30%; padding-left: 0px">Run Type</label>
                        <label style="width: 20%;">
                            <input type="radio" name="run-type"
                                   onclick="chooseAutorunType('for');" value="for"
                                   required checked>
                            for
                        </label>
                        <label>
                            <input type="radio" name="run-type"
                                   onclick="chooseAutorunType('for-each');" value="for-each">
                            for each
                        </label>
                    </div>
                    <div style="margin-top: 10px; margin-bottom: 10px; width: 100%" class="input-group">
                        <select id='bq-feature-label' name='bq-feature-label'
                                class="selectpicker form-control show-menu-arrow show-tick"
                                data-size="5" title="feature" data-width="40%"
                                data-live-search="true">
                        </select>
                        <select id='bq-feature-op' name='bq-feature-op'
                                class="selectpicker form-control show-menu-arrow"
                                data-size="6" data-width="20%">
                            <option value="<=">&le;</option>
                            <option value="<">&lt;</option>
                            <option value=">=">&ge;</option>
                            <option value=">">&gt;</option>
                            <option value="!=">&ne;</option>
                            <option value="=" selected>=</option>
                        </select>
                        <input type="hidden" name="bq-feature-type" id="bq-feature-type">
                        <input type="text" class="form-control" id="bq-feature-value" data-provide="typeahead"
                               autocomplete="off" name="bq-feature-value"
                               style="width: 40%; margin-left: -2px; border-bottom-right-radius: 4px;
                               border-top-right-radius: 4px;"
                               placeholder="value"/>
                    </div>
                    <div class="input-group" style="width: 100%">
                        <input id="where-clause" class="form-control" type="text" disabled value="Where"
                               style="width: 25%; cursor: auto; background-color: #eceeef;
                                       border: 1px solid #ccc;"/>
                        <select id='bq-constraint' name='bq-constraint'
                                class="selectpicker form-control show-menu-arrow show-tick"
                                data-live-search="true"
                                data-size="8" data-width="75%" title="Choose a constraint">
                        </select>
                    </div>
                </div>
            </div>
            <div class="radio" style="padding-top: 10px;">
                <label style="padding-bottom: 10px">
                    <input type="radio" name="datasource"
                           onclick="chooseDatasource('combiner');" required value="combiner">
                    Combiner
                </label>
                <input id="combiner-title" name="combiner-title" type="text" class="form-control"
                           placeholder="Type a title, optional" style="margin-left: 20px; width: calc(100% - 40px);"/>
            </div>
            <label style="font-weight: 500; font-size: 15px; margin: 10px 0 5px 0px">Workflow</label>
            <div style="margin: 0px 20px 0px 20px">
                <select id='workflow' name='workflow' class="selectpicker form-control show-menu-arrow show-tick"
                        data-size="5" title="Choose a flow"
                        {% if workflows|length > 5 %} data-live-search="true" {% endif %}>
                    {% for workflow in workflows %}
                        <option value="{{ workflow.id }}">{{ workflow.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin: 30px 80px 0px 80px;">
                <button id='start-flow' type="submit" class="btn btn-block btn-warning">Start</button>
            </div>
        </form>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="polygon-modal" role="dialog" data-keyboard="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-body" style="padding-top: 5px">
                    <label class="sub-heading">Name this Polygon</label>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <input type="text" class="form-control" id="polygon-name" placeholder="type polygon name here"/>
                    <button id="save-polygon" type="button" class="btn theme-bg-border"
                            style="padding: 5px 10px 5px 10px; margin-top: 15px;">Save
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block bodyscripts %}
    <script src="{% static  'js/columbus-bqhome.js' %}"></script>
    <!-- Loading the Google Maps API. -->
    <script src="https://maps.google.com/maps/api/js?libraries=places,drawing,visualization&callback=initMap&key=AIzaSyBmgPNSfhXOslSk0fRyf7t0NG7lZ5s7d8s"
            async defer>
    </script>
{% endblock %}
